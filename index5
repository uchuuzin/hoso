<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>放送台本管理ツール（ローカル保存対応）</title>
<style>
body { font-family: sans-serif; margin: 20px; }
button { margin: 2px; }
.section { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
.corner { margin-left: 20px; }
.header { display: flex; gap: 10px; margin-bottom: 15px; }
textarea { width: 100%; height: 100px; }
</style>
</head>
<body>

<h1>放送台本管理ツール</h1>

<div class="header">
  <button onclick="addEpisode()">新規放送追加</button>
  <button onclick="exportJSON()">JSONエクスポート</button>
  <button onclick="importJSON()">JSONインポート</button>
  <button onclick="clearLocal()">ローカル削除</button>
</div>

<div id="episodeList"></div>

<h2>JSONバックアップ / インポート</h2>
<textarea id="jsonArea" placeholder="ここにJSONを貼り付け"></textarea>

<script>
let episodes = [];

// ページ読み込み時にlocalStorageからデータを読み込む
window.onload = function() {
  const saved = localStorage.getItem('episodes');
  if (saved) {
    episodes = JSON.parse(saved);
  }
  renderEpisodes();
};

// データをlocalStorageに保存
function saveLocal() {
  localStorage.setItem('episodes', JSON.stringify(episodes));
}

// 放送回を表示
function renderEpisodes() {
  const list = document.getElementById('episodeList');
  list.innerHTML = '';
  episodes.forEach((ep, index) => {
    const section = document.createElement('div');
    section.className = 'section';
    
    section.innerHTML = `
      <strong>第${index+1}回 放送</strong> - ${ep.date || '日付未設定'} 
      <button onclick="editEpisode(${index})">編集</button>
      <button onclick="duplicateEpisode(${index})">複製</button>
      <button onclick="deleteEpisode(${index})">削除</button>
      <div class="corner">
        <h4>オープニング</h4>
        <p>${ep.opening || ''}</p>
        <h4>雑学コーナー</h4>
        <p>${ep.trivia || ''}</p>
        <h4>エンディング</h4>
        <p>${ep.ending || ''}</p>
      </div>
    `;
    list.appendChild(section);
  });
  saveLocal(); // 表示後に保存
}

// 新規放送追加
function addEpisode() {
  const date = prompt("日付を入力 (YYYY-MM-DD)");
  if (!date) return;
  const newEp = { date, opening:'', trivia:'', ending:'' };
  episodes.push(newEp);
  renderEpisodes();
  editEpisode(episodes.length-1, { skipDate: true });
}

// 編集
function editEpisode(index, options={}) {
  const ep = episodes[index];
  if (!options.skipDate) {
    ep.date = prompt("日付を入力", ep.date) || ep.date;
  }
  ep.opening = prompt("オープニング内容を入力", ep.opening) || ep.opening;
  ep.trivia = prompt("雑学コーナー内容を入力", ep.trivia) || ep.trivia;
  ep.ending = prompt("エンディング内容を入力", ep.ending) || ep.ending;
  renderEpisodes();
}

// 複製
function duplicateEpisode(index) {
  const copy = {...episodes[index]};
  episodes.splice(index+1, 0, copy);
  renderEpisodes();
}

// 削除
function deleteEpisode(index) {
  if(confirm('本当に削除しますか？')){
    episodes.splice(index, 1);
    renderEpisodes();
  }
}

// JSONエクスポート
function exportJSON() {
  document.getElementById('jsonArea').value = JSON.stringify(episodes, null, 2);
}

// JSONインポート
function importJSON() {
  try{
    const data = JSON.parse(document.getElementById('jsonArea').value);
    if(Array.isArray(data)) {
      episodes = data;
      renderEpisodes();
    } else {
      alert("JSONの形式が正しくありません");
    }
  } catch(e){
    alert("JSON解析エラー: " + e.message);
  }
}

// ローカル削除
function clearLocal() {
  if(confirm('ローカルに保存された全データを削除しますか？')) {
    localStorage.removeItem('episodes');
    episodes = [];
    renderEpisodes();
  }
}
</script>

</body>
</html>
